From 24c13c7faf2682fe4c100c9c7976f59dde769f1c Mon Sep 17 00:00:00 2001
From: Tadeu Manoel <e.tadeu@gmail.com>
Date: Fri, 22 Mar 2019 15:58:46 -0300
Subject: [PATCH] Fix linking with python in macOS

Also remove LINK_PYTHON_LIBRARY CMake flag

See https://blog.tim-smith.us/2015/09/python-extension-modules-os-x/
and https://github.com/conda-forge/cgal-feedstock/pull/41
---
 CMakeLists.txt                       | 2 --
 cmake/Modules/SWIG_CGAL_Macros.cmake | 4 +++-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index c28f40b..5098275 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -12,8 +12,6 @@ if (POLICY CMP0042)
   cmake_policy (SET CMP0042 NEW)
 endif()
 
-option ( LINK_PYTHON_LIBRARY "Link against python libraries" ON )
-
 if (POLICY CMP0078)
   cmake_policy (SET CMP0078 NEW)
 endif()
diff --git a/cmake/Modules/SWIG_CGAL_Macros.cmake b/cmake/Modules/SWIG_CGAL_Macros.cmake
index 8d18934..d66034e 100644
--- a/cmake/Modules/SWIG_CGAL_Macros.cmake
+++ b/cmake/Modules/SWIG_CGAL_Macros.cmake
@@ -101,8 +101,10 @@ MACRO(ADD_SWIG_CGAL_PYTHON_MODULE packagename)
     else ()
       set_target_properties (${MODULENAME}_python PROPERTIES OUTPUT_NAME ${MODULENAME})
     endif ()
-    if (LINK_PYTHON_LIBRARY)
+    if (WIN32)
       swig_link_libraries (${MODULENAME}_python ${PYTHON_LIBRARIES})
+    elseif (APPLE)
+      set_target_properties(${MODULENAME}_python PROPERTIES LINK_FLAGS "-undefined dynamic_lookup")
     endif ()
     swig_link_libraries (${MODULENAME}_python ${libstolinkwith})
     install (FILES ${PYTHON_OUTDIR_PREFIX}/CGAL/${MODULENAME}.py DESTINATION ${PYTHON_MODULE_PATH}/CGAL)
-- 
2.20.1.windows.1

